void picture_pool_Delete(picture_pool_t *pool)
{
    for (int i = 0; i < pool->picture_count; i++) {
        picture_t *picture = pool->picture[i];
        if (pool->master) {
            for (int j = 0; j < pool->master->picture_count; j++) {
                if (pool->master->picture[j] == picture)
                    pool->master->picture_reserved[j] = false;
            }
        } else {
            picture_gc_sys_t *gc_sys = picture->gc.p_sys;
            assert(vlc_atomic_get(&picture->gc.refcount) == 0);
            assert(!pool->picture_reserved[i]);
            /* Restore old release callback */
            vlc_atomic_set(&picture->gc.refcount, 1);
            picture->gc.pf_destroy = gc_sys->destroy;
            picture->gc.p_sys      = gc_sys->destroy_sys;
            picture_Release(picture);
            free(gc_sys);
        }
    }
    free(pool->picture_reserved);
    free(pool->picture);
    free(pool);
}
